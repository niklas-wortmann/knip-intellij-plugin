{"id":"knip-intellij-plugin-bgt","title":"NPX fails to determine executable for @knip/language-server","description":"During the first dry run of the Knip IntelliJ plugin, the language server fails to start with repeated npm errors:\n\n```\nnpm error could not determine executable to run\nnpm error A complete log of this run can be found in: /Users/jan-niklaswortmann/.npm/_logs/2026-01-06T20_45_44_981Z-debug-0.log\n```\n\nThis error occurs multiple times and causes:\n1. Language server fails to start\n2. Timeout errors when trying to shutdown the non-running server:\n   ```\n   WARN - com.redhat.devtools.lsp4ij.LanguageServerWrapper - Timeout error while shutdown the language server 'knipLanguageServer'\n   java.util.concurrent.TimeoutException\n   ```\n\n**Root Cause Analysis:**\nThe `KnipStreamConnectionProvider` uses `npx @knip/language-server --stdio` but npx cannot find/determine the executable. This could be due to:\n1. The package `@knip/language-server` not being installed globally or locally\n2. npx not being able to resolve the package from the registry\n3. The package's `bin` field not being properly configured\n4. Network/registry issues preventing npx from downloading the package\n\n**Reproduction Steps:**\n1. Open IntelliJ with the Knip plugin installed\n2. Open a JavaScript/TypeScript project\n3. Observe npm errors in the IDE logs\n\n**Expected Behavior:**\nThe language server should start successfully and provide diagnostics for unused code.\n\n**Actual Behavior:**\nMultiple \"npm error could not determine executable to run\" errors, followed by timeout errors when the plugin tries to shutdown the non-existent server.","design":null,"acceptance_criteria":"- [ ] Investigate why npx cannot determine the executable for @knip/language-server\n- [ ] Implement fallback mechanism if npx fails (e.g., try global install, local node_modules)\n- [ ] Add better error messaging to inform users what went wrong\n- [ ] Consider requiring users to install @knip/language-server globally first\n- [ ] Add validation in settings to check if the language server is available before starting\n- [ ] Test with fresh environment to ensure server starts correctly","notes":null,"external_ref":null,"status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-06T14:49:29.360904-06:00","updated_at":"2026-01-06T14:49:29.360904-06:00","closed_at":null,"assignee":null,"labels":["bug","critical","lsp","startup"],"dependency_count":0,"dependent_count":0,"dependencies":[{"id":"knip-intellij-plugin-tl9","title":"Knip Language Server IntelliJ Plugin","description":"Implement an IntelliJ plugin that integrates the @knip/language-server to provide real-time detection of unused files, dependencies, and exports in JavaScript/TypeScript projects.\n\nThe plugin should:\n- Start/stop the Knip language server automatically\n- Display diagnostics (unused code warnings) in the editor\n- Support configuration via knip.json/knip.ts\n- Work with WebStorm, IntelliJ IDEA, and other JetBrains IDEs","design":null,"acceptance_criteria":null,"notes":null,"external_ref":null,"status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T14:04:13.724316-06:00","updated_at":"2026-01-06T14:39:35.204313-06:00","closed_at":"2026-01-06T14:39:35.204313-06:00","assignee":null,"labels":["knip","lsp","plugin"],"dependency_count":0,"dependent_count":0,"dependency_type":"parent-child"}],"dependents":[]}