<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.niklaswortmann.knipintellijplugin</id>
    <name>Knip</name>
    <vendor>Jan-Niklas Wortmann</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>JavaScript</depends>

    <extensions defaultExtensionNs="com.intellij">
        <projectConfigurable
            parentId="tools"
            instance="com.github.niklaswortmann.knipintellijplugin.settings.KnipSettingsConfigurable"
            id="com.github.niklaswortmann.knipintellijplugin.settings.KnipSettingsConfigurable"
            displayName="Knip"
            nonDefaultProject="true"/>
        <notificationGroup id="Knip" displayType="BALLOON"/>

        <!-- File type registration for Knip config files -->
        <!-- This enables automatic plugin discovery: when a user opens a Knip config file -->
        <!-- in an IDE without this plugin, the IDE will suggest installing it -->
        <!-- See: https://plugins.jetbrains.com/docs/marketplace/intellij-plugin-recommendations.html#file-type -->
        <fileType
            name="Knip Config"
            implementationClass="com.github.niklaswortmann.knipintellijplugin.filetype.KnipConfigFileType"
            fieldName="INSTANCE"
            fileNames="knip.json;knip.jsonc"
            patterns="knip.ts;knip.config.ts;knip.config.js"/>
        
        <!-- Registry key for Knip language server version override -->
        <registryKey defaultValue="" description="Override Knip language server version (leave empty for default)" key="knip.language.server.default.version"/>
        
        <!-- Plugin discovery via npm dependency -->
        <!-- When a project has 'knip' in package.json, the IDE will suggest installing this plugin -->
        <!-- See: https://plugins.jetbrains.com/docs/marketplace/intellij-plugin-recommendations.html#dependency-support -->
        <dependencySupport kind="javascript" coordinate="npm:knip" displayName="Knip"/>
        
        <!-- Platform LSP API Registration -->
        <platform.lsp.serverSupportProvider
            implementation="com.github.niklaswortmann.knipintellijplugin.lsp.KnipLspServerSupportProvider"/>
    </extensions>

    <!-- JavaScript plugin extensions for TypeScript service integration -->
    <extensions defaultExtensionNs="JavaScript">
        <languageServiceProvider
            order="last"
            implementation="com.github.niklaswortmann.knipintellijplugin.lsp.KnipLanguageServiceProvider"/>
    </extensions>

    <actions>
        <action id="Knip.RestartServer"
                class="com.github.niklaswortmann.knipintellijplugin.actions.RestartKnipServerAction"
                text="Restart Knip Language Server"
                description="Restart the Knip language server">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
