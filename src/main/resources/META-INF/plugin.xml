<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.niklaswortmann.knipintellijplugin</id>
    <name>Knip</name>
    <vendor>niklas-wortmann</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.redhat.devtools.lsp4ij</depends>

    <extensions defaultExtensionNs="com.intellij">
        <projectConfigurable
            parentId="tools"
            instance="com.github.niklaswortmann.knipintellijplugin.settings.KnipSettingsConfigurable"
            id="com.github.niklaswortmann.knipintellijplugin.settings.KnipSettingsConfigurable"
            displayName="Knip"
            nonDefaultProject="true"/>
        <notificationGroup id="Knip" displayType="BALLOON"/>
        <postStartupActivity implementation="com.github.niklaswortmann.knipintellijplugin.startup.KnipDetectionActivity"/>
    </extensions>

    <actions>
        <action id="Knip.RestartServer"
                class="com.github.niklaswortmann.knipintellijplugin.actions.RestartKnipServerAction"
                text="Restart Knip Language Server"
                description="Restart the Knip language server">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>

    <!-- LSP4IJ Language Server Registration -->
    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <server id="knipLanguageServer"
                name="Knip"
                factoryClass="com.github.niklaswortmann.knipintellijplugin.lsp.KnipLanguageServerFactory">
            <description><![CDATA[
                Knip language server for detecting unused files, dependencies, and exports in JavaScript/TypeScript projects.
            ]]></description>
        </server>

        <!-- File type mappings for Knip language server -->
        <fileTypeMapping fileType="JavaScript"
                         serverId="knipLanguageServer"
                         languageId="javascript" />
        <fileTypeMapping fileType="TypeScript"
                         serverId="knipLanguageServer"
                         languageId="typescript" />
        <fileTypeMapping fileType="JSX Harmony"
                         serverId="knipLanguageServer"
                         languageId="javascriptreact" />
        <fileTypeMapping fileType="TypeScript JSX"
                         serverId="knipLanguageServer"
                         languageId="typescriptreact" />
        
        <!-- File name pattern mappings for config files -->
        <fileNamePatternMapping patterns="package.json;knip.json;knip.jsonc"
                                serverId="knipLanguageServer"
                                languageId="json" />
        <fileNamePatternMapping patterns="*.config.js;*.config.ts;*.config.mjs;*.config.cjs"
                                serverId="knipLanguageServer"
                                languageId="javascript" />
    </extensions>
</idea-plugin>
